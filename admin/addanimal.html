<header>
    <title> Admin View </title>
    <link rel="stylesheet" href="/styles.css">
    <script type = "module" src="/js/adminAddHandlers.js"></script>

</header>

<body>

    <div class = "nav">
        <button class="back-button" onclick="window.location.href='/admin/home'">Back</button>
        <h1>Add An Animal</h1>
    </div>
    <div class="navspacer"></div>
    
    <!-- for errors, etc instead of alert! -->
    <div id="message-box" style="display: none;">
        <p>MESSAGE BOX</p>
    </div>
    <!-- add a new pet -->
    <form id = "animalForm">
        <p class = "form_header">Mandatory Fields</p>
        <label for="Name">Name:</label><br>
        <input type="text" id="name" name="name" placeholder="Pet's Name" required>
        <br>
        <label for="Age">Age Group:</label><br>
 
        <select id="agegroup" required>
            <option value = "" disabled selected>Select age group</option>
            <option value="Baby">Baby</option>
            <option value="Young">Young</option>
            <option value="Aduly">Adult</option>
            <option value="Elderly">Elderly</option>
        </select>
        <br>

        <label for="Gender">Gender:</label><br>
        <select id="gender" required>
            <option value = "" disabled selected>Select gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select>
        <br>

        <label for="ActivityLevel">Activity Level:</label><br>
        <select id="activitylevel" required>
            <option value = "" disabled selected>Select activity level</option>
            <option value="Low">Low</option>
            <option value="Medium">Medium</option>
            <option value="High">High</option>
        </select>
        <br>
        <label for="Animal">Type:</label><br>
        <select id="animal" required>
            <option value = "" disabled selected>Select animal type</option>
            <option value="Dog">Dog</option>
            <option value="Cat">Cat</option>
            <option value="Other">Other</option>
        </select>
        <br>
        <label for="InFoster">Foster:</label><br>
        <select id="infoster" required>
            <option value = "" disabled selected>Select foster status</option>
            <option value="In Foster">In Foster</option>
            <option value="Not in Foster">Not in Foster</option>
        </select>
        <br>
        <label for="IntakeDate">Intake Date:</label><br>
        <input type="date" id="intakedate" name="IntakeDate">
        <br>
        <label for="Size">Size:</label><br>
        <select id="size" required>
            <option value = "" disabled selected>Select size</option>
            <option value="Small">Small</option>
            <option value="Medium">Medium</option>
            <option value="Large">Large</option>
        </select>
        <br>
        
        <p class = "form_header">Optional Fields</p>

        <label for="age">Age:</label><br>
        <input type="text" id="age" name="age" placeholder="Pet's Age">
        <br>
        <label for="fixed">Fixed:</label><br>
        <select id="fixed">
            <option value="">Select an option</option>
            <option value="UnFixed">Unfixed</option>
            <option value="Fixed">Fixed</option>
        </select>
        <br>

        <!-- TODO: make this check boxes -->
        <label for="goodwith">Good With:</label><br>
        <input type="text" id="goodwith" name="goodwith" placeholder="Kids, Cats, etc">
        <br>
        <label for="personality">Personality:</label><br>
        <input type="text" id="personality" name="personality" placeholder="Pet's Personality">
        <br>
        <label for="health">Health:</label><br>
        <input type="text" id="health" name="health" placeholder="vaccine records, etc">
        <br>
        <label for="breed">Breed:</label><br>
        <input type="text" id="breed" name="breed" placeholder="Pet's Breed">
        <br>
        <label for="weight">Weight:</label><br>
        <input type="text" id="weight" name="weight" placeholder="Pet's Weight">
        <br>

        <label for="hypoallergenic">Hypoallergenic:</label><br>
        <select id="hypoallergenic">
            <option value="">Select an option</option>
            <option value="Not Hypoallergenic">Not Hypoallergenic</option>
            <option value="Hypoallergenic">Hypoallergenic</option>
        </select>
        <br>
        <!-- <label for="fileupload">Animal Image (Optional):</label><br>
        <input type="file" name="file" id="fileupload" accept="image/*">
  -->

        <!-- submit! -->
        <button type = "submit">Add New Pet</button>
    </form>

    <form action="/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="file" id="fileupload" accept="image/*">
         <button type = "submit">upPet</button>
    </form>
</body>


<script type = "module">
    import { addAnimal } from "/js/adminAddHandlers.js";

    const img_form = document.getElementById('uploadForm');
    const status = document.getElementById('status');

    img_form.addEventListener('submit', async (e) => {
        e.preventDefault(); // prevent page reload

        const fileInput = document.getElementById('fileupload');
        if (!fileInput.files.length) {
            status.textContent = 'Please select a file.';
            return;
        }

        const formData = new FormData();
        formData.append('file', fileInput.files[0]);

        try {
            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });

            const text = await response.text();
            status.textContent = text;
        } catch (err) {
            console.error(err);
            status.textContent = 'Upload failed.';
        }
    });



    document.addEventListener('DOMContentLoaded', () => {
        try {

            let newData
            //making sure that we don't try to getelementbyid until after the user clicks submit
            const form = document.getElementById('animalForm');
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                console.log('Processing animal data...');
                //handling (potential) image
                const file = document.getElementById('fileupload').files[0];

                let imageUploadResult = { success: true, filename: null, url: null };

                // Only upload if a file is selected
                if (file) {
                    imageUploadResult = await uploadImage(file);
                    console.log(imageUploadResult);
                    
                    if (!imageUploadResult.success) {
                        console.log("error uploading image");
                    }
                }
                // fields
                const fields = ["animal", "name", "agegroup", "gender", "infoster", "intakedate", "activitylevel", "size", "age", "description", "goodwith", "personality", "health", "breed", "weight", "hypoallergenic", "fixed"];

                newData = {}
                for (let i = 0; i < fields.length; i++) {
                    const field = fields[i];
                    try {
                    const form_input = document.getElementById(field).value;
                    if (form_input) newData[field] = form_input;
                    } catch (e) {}
                }

                //add image name
                if (imageUploadResult.filename) {
                    newData['image_url'] = imageUploadResult.filename; 
                } 

                addAnimal(newData);
                    
            });
        
        } catch (err) {
            console.log('didntwork')
            console.error(err);
        }
    });           

</script>


